<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.3.3">Jekyll</generator><link href="https://gavin-lijy.github.io/feed.xml" rel="self" type="application/atom+xml"/><link href="https://gavin-lijy.github.io/" rel="alternate" type="text/html" hreflang="en"/><updated>2024-03-11T17:28:03+00:00</updated><id>https://gavin-lijy.github.io/feed.xml</id><title type="html">blank</title><subtitle>A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. </subtitle><entry><title type="html">Mapping and batch correction</title><link href="https://gavin-lijy.github.io/blog/2023/mapping/" rel="alternate" type="text/html" title="Mapping and batch correction"/><published>2023-03-05T00:00:00+00:00</published><updated>2023-03-05T00:00:00+00:00</updated><id>https://gavin-lijy.github.io/blog/2023/mapping</id><content type="html" xml:base="https://gavin-lijy.github.io/blog/2023/mapping/"><![CDATA[<h1 id="mnn-and-seurat-transfer">MNN and seurat transfer</h1> <h2 id="key-differences">Key differences</h2> <ul> <li> <p>MNN <strong>does batch correction by <code class="language-plaintext highlighter-rouge">reducedMNN</code></strong>etc. (for each query cell, MNN pair specific batch vector s are weighted by Gaussian kernel, and distance is from the query cell to the cells in the MNN set of query dataset), <u>and then find KNN on corrected space for each query cell to **transfer information.**</u></p> <p>https://static-content.springer.com/esm/art%3A10.1038%2Fnbt.4091/MediaObjects/41587_2018_BFnbt4091_MOESM65_ESM.pdf</p> <p><img src="https://p.ipic.vip/7u68i8.png" alt="image-20230304182118476"/></p> </li> <li> <p>When Seurat uses <code class="language-plaintext highlighter-rouge">TransferData</code>, it doesnâ€™t do batch effect, but by default uses reference PCA structure to find anchors, and then transfers information using kernel weighted mean.</p> </li> </ul> <h2 id="workflows">Workflows</h2> <h3 id="mnn">MNN</h3> <ul> <li>Find MNN on raw PCA space</li> <li>Correct batch effect, gaussian kernel applied</li> <li>Run KNN on corrected space</li> <li>Transfer by majority voting among KNN</li> </ul> <h3 id="seurat">Seurat</h3> <ul> <li> <p>Find anchors on reference PCA</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Seurat has an option (set by default) to project the PCA structure of a reference onto the query, instead of learning a joint structure with CCA.
</code></pre></div> </div> </li> <li> <p>Transfer kernel weighted information of anchors</p> </li> <li> <p>When <code class="language-plaintext highlighter-rouge">IntegrateEmbeddings</code></p> <ul> <li>Correct batch by subtracting kernel weighted anchor-specific correction vectors (the same as MNN)</li> </ul> <p><a href="https://satijalab.org/seurat/reference/integratedata">https://satijalab.org/seurat/reference/integratedata</a></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Compute the anchor integration matrix as the difference between the two expression matrices for every pair of anchor cells
Compute the transformation matrix as the product of the integration matrix and the weights matrix.
Subtract the transformation matrix from the original expression matrix.
</code></pre></div> </div> <ul> <li>Project the query data onto the UMAP structure of the reference</li> </ul> </li> </ul>]]></content><author><name>Jingyu Gavin li</name></author><category term="single-cell"/><summary type="html"><![CDATA[Compare MNN and Seurat transfer]]></summary></entry></feed>